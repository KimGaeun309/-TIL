# 12 강 - KeyPAD & StepMotor

## 키 패드(KeyPAD)

먼저 키패드에 대한 실습을 해보도록 하겠습니다. 키 패드는 키보드의 간단한 버전. 키보드도 내부적으로 살펴보면 키 버튼이 많이 포함되어있고 키보다 하나가 하나의 시스템이고 칩이 있는데 이를 USB통해서 PC에 연결할 수 있는데 이 키 버튼을 누르면 이 값을 칩이 인식해서 PC로 보냄. PC 입장에선 I/O .. 입력 받는 하나의 장치라고 볼 수 있음. 우리 실습에서는 이 키 패드 뿐만 아니라 LCD를 사용해 눌려지는 글자를 출력하는 것도 할 수 있다. 키 패드에는 16개의 키 버튼이 매트릭스 형태로 있다. 키 패드가 어떤 방식으로 동작하는지 간단하게 살펴보자.

키 패드 인터페이스 방식을 나누자면 정적 인터페이스(= 키 버튼에 대해서 각각 하나의 핀에 연결해 검사하는 방식, 하드웨어 구성이 간편하지만 포트 사용이 비효율적) 과 동적 인터페이스(= 키를 매트릭스 형태로 구성해 모든 키 버튼에 대해 연결하지 않고 row, col 선에 대해서만 핀으로 연결해 신호를 넣어주었을 때 각각의 row에 dynamic하게 넣어주었을 때 어떤 col이 연결되는지 확인해 판별함. 적은 포트 사용하나 눌린 스위치 검출 방법이 복잡) 

### 정적 인터페이스(Static Interface) 방식

버튼, 스위치로 하나씩 연결하는 인터페이스.

### 동적 인터페이스(Dynamic Interface) 방식

row는 row끼리, col은 col끼리 연결되어있음.

row가 4개, col이 3개인 경우,  이 때 예를 들어 row 0번에 1을 넣어주었을 때 1번 스위치만 눌렸다면 0번 col의 신호가 와서? 어느 버튼이 눌렸는지 검출 가능하다. 

### 동적 인터페이스 방식에서의 신호에 따른 스위치 눌림 검출표

우리는 실습에 보면 4x4 키 패드가 있다. 위쪽에 보면 IN0 IN1 IN2 IN3 라고 써져 있고 다른 쪽엔 LINE0 LINE1 LINE2 LINE3 가 써져 있다. IN이 input이고 이걸 포트 하나에 몰아 놓고 (GPIOA의 0~3은 IN, 4~7은 LINE) 검출.하드웨어적으로는 동시에 눌린 것 확인 가능하나 소프트웨어에서는 순차적으로 확인함. main문에서 GPIO 설정을 다 하고 체크. 우리가 사용하는 키트에는 입력을 할 때면 반대로, 0을 넣은 col에 대해 체크할 때는 1이 올라오는 라인에 대해 detect..?

## 실습: KeyPAD를 이용한 비밀번호 입력기 - 사전지식

우리가 지금 16개 키 패드가 있는데 번호를 

1 2 3

4 5 6

7 8 9

r 0 b

이렇게 매기고 textLCD에 이걸 비밀번호로 (****) 입력 받아 이 네 개의 비밀번호가 이미 내장된 비밀번호와 일치하는지 확인하는 소프트웨어를 구성해볼 것이다.

그리고 하드웨어를 보면 제일 오른쪽에 GND와 VCC 연셕시키는 역할하는 게 있고 왼쪽엔 IN 0~3, 가운데엔 LINE 0~3 이 있다. 여기에 포트는 포트 핀 01234567에서 IN0~IN3을 Pin0~3, LINE0~3을 Pin4~7로 넣어주도록 프로그래밍을 해야 한다.

# 스텝모터(Step Motor)

마지막 실습으로 스텝 모터를 구동시키는 실습을 해볼 것.

## 스테핑 모터(스텝 모터, 펄스 모터)

모터 축이 회전하는데 모터의 회전을 제대로 확인하고 싶으면 돌림판을 끼우면 된다.  우리가 사용하는 건 스테핑 모터이다. 자세하게 알 필요는 ㅇ벗고 전기적인 펄스를 입력받아서 자기장의 힘을 편향시켜 정확한 각도에 의해 돌아가는 모터이다.

우리가 사용하는 스테핑 모터는 A B /A /B 네 개의 신호를 주기적으로 반복해서 넣어주는 방식에 의해 모터의 전기장 자기장, 코일의 회전력을 발생시켜서 회전시키는. 전기적 신호를 기계적 회전으로 바꾸는 것. 

### 스테핑 모터의 구조

축이 있고 모터 톱니바퀴가 있다.

고정자와 회전자가 있다. (외부에 고정자...)

A B A바 B바 ..

자기장을 흘러주면 회전자에 있는 톱니가 전류를 흘리는데 그에 맞추어 돌아가도록 되어있다. A에 전류가 들어오면 1, 나머지는 0. 이 상태에서 A에 0을 넣고 B에 1을 넣으면 회전이 조금 된다. 다시 A바에 1, B에 0을 넣으면 또 회전이 조금 된다. 이런 식으로 돌아간다. (톱니가 돌아간다.) 

### 스테핑 모터 구동방법

A /A B /B가 지속적으로 나가도록 구성되어있다. 그에 따라 조금씩 회전된다. 전기 신호를 받아서 회전된다... 

마이크로프로세서에서는 A /A B /B를 GPIO output으로 출력한다. 예를 들어 핀 -0 1 2 3.ㅁ 이를  마이크로컨트롤러에서 프로그래밍을 해서 값을 넣어주면 그에 맞게 회전되도록.

### 1상 여자 방식 (Full step)

회전을 시키는 방식, 값을 넣는 방식 세 가지가 있다. 1상 여자 방식, 2상 여자 방식, 1-2상 여자방식.

1상 여자방식에서는 한 주기마다 1의 값ㅇ르 교대로 전달해준다. (A B /A /B) (1000 0100 0010 0001) 이를 반복하면 모터가 돌아간다. 이 주기를 빠르게 하면 빠르게,  느리게 하면 느리게 돌아간다. 1개의 코일만을 차례로 여자해 소비 전력이 낮고 1ㅌ스텝당 정밀도가 높으나 진동이 크고(떨림이 심할 가능성.) 탈조하기 쉽다.

### 1상 여자 방식 동작 타이밍

1000 1000

0100 0100

0010 0010

0001 0001

### 2상 여자 방식

한 번에 두 개씩 값을 내보내기를 주기적으로 반복함. 한 번에 두 개의 코일에 동시에 여자함. 따라서 한 번당 2배의 전류가 필요해 1상 여자방식보다 많은 전류가 필요하나 감쇠진동이 적어 안정적으로 돌아간다.

### 2상 여자 방식 동작 타이밍

1001 1001

1100 1100

0110 0110

0011 0011

### 1-2상 여자 방식

1상과 2상을 보완한 것. 1상 여자방식에 비해 1.5배의 전류가 필요.

1상에 비해 안정적이나 2상에 비해 덜 안정적. 

1펄스에 대한 스텝 각은 2상 여자와 2상 여자에 의한 스텝 각의 1/2...?

각도를 정밀하게 제어하는 경우에 사용.

1주기가 8...

### 1-2상 여자 방식 동작 타이밍

11000001 11000001

01110000 01110000

00011100 00011100

00000111 00000111

## 실습: 스텝 모터 돌리기 - 사전지식

모터를 중계해주는 중게획로가 있는데 이 회로는 모터를 한 번에 두 개를 연결할 수 있다.모터가 두 개가 있으면 이것으로 바퀴 두 개를 회전시킬 수 있다.  각 하나의 모터당 네 개의 핀이 필요하니까 네 개의 모터를 쓰면 두 개의 GPIO가 필요하고 두 개의 모터를 쓰면 한 개의 GPIO가 필요. 

실습에서는 모터 하나를 제어하는 실습을 할 것.]

우리 실습에서는 1상 여자방식으로 해볼 것.

실습은 GPIO 네 개의 핀

### 스텝모터의 1상 여자 방식 신호 만들기

### 스텝모터의 1-2상 여자 방식 신호 만들기

### GPIO D0-D3 사용

### 타이머 사용

### 인터럽트 사용

# 최종 과제: TextLCD, KeyPAD, Step Motor 를 사용